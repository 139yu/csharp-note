<Window x:Class="Nobody.DigitaPlatform.Views.Dialog.VariableUnionCOnditionDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Nobody.DigitaPlatform.Views.Dialog"
        xmlns:converter="clr-namespace:Nobody.DigitaPlatform.Common.Converter;assembly=Nobody.DigitaPlatform.Common"
        xmlns:sys="clr-namespace:System;assembly=System.Runtime"
        mc:Ignorable="d"
        ResizeMode="NoResize"
        FontFamily="Microsoft YaHei" FontWeight="ExtraLight" FontSize="12"
        WindowStartupLocation="CenterScreen"
        Title="变量报警条件配置" Height="400" Width="600">
    <WindowChrome.WindowChrome>
        <WindowChrome GlassFrameThickness="1" />
    </WindowChrome.WindowChrome>
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary
                    Source="pack://application:,,,/Nobody.DigitaPlatform.Assets;component/Styles/ButtonStyle.xaml" />
                <ResourceDictionary
                    Source="pack://application:,,,/Nobody.DigitaPlatform.Assets;component/Styles/ComboxStyle.xaml" />
                <ResourceDictionary>
                    <converter:RowNumberConverter x:Key="rnc" />
                </ResourceDictionary>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>
    <Grid>
        <Grid.Resources>
            <ResourceDictionary>
                <Style TargetType="TextBox">
                    <Setter Property="VerticalContentAlignment" Value="Center" />
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="TextBox">
                                <Border Name="br" BorderThickness="1" Background="#fff" CornerRadius="5"
                                        BorderBrush="#eee">
                                    <Grid>
                                        <TextBlock Name="mark" Text="{TemplateBinding Tag}"
                                                   Margin="5,0" Foreground="#888"
                                                   Visibility="Collapsed" VerticalAlignment="Center" />
                                        <ScrollViewer Name="PART_ContentHost" Margin="0" />
                                    </Grid>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsFocused" Value="True">
                                        <Setter TargetName="br" Property="BorderBrush" Value="#16a1ff"></Setter>
                                    </Trigger>
                                    <DataTrigger
                                        Binding="{Binding RelativeSource={RelativeSource Mode=Self},Path=Text}"
                                        Value="">
                                        <Setter TargetName="mark" Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </ResourceDictionary>
        </Grid.Resources>
        <Grid.RowDefinitions>
            <RowDefinition Height="50" />
            <RowDefinition />
            <RowDefinition Height="40" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="150" />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <!--左侧背景颜色-->
        <Border Grid.Column="0" Grid.Row="0" Grid.RowSpan="3" Background="#AA409EFE" />
        <Border Grid.Row="0" Grid.Column="0" WindowChrome.IsHitTestVisibleInChrome="True" CornerRadius="15"
                BorderThickness="0"
                VerticalAlignment="Center" Background="#99ffffff" Margin="10,0">
            <TextBox Margin="10,0,30,0" MinHeight="26" Style="{x:Null}" Foreground="#888"
                     BorderThickness="0" VerticalContentAlignment="Center" Background="Transparent">
            </TextBox>
        </Border>
        <TextBlock Grid.Column="0" Grid.Row="0"
                   Margin="0,0,20,0" FontSize="20"
                   VerticalAlignment="Center" HorizontalAlignment="Right" Text="&#xe647;"
                   FontFamily="{StaticResource Iconfont}" />
        <ScrollViewer Grid.Column="0" Grid.Row="1" Grid.RowSpan="2" VerticalScrollBarVisibility="Hidden">
            <ListBox Background="Transparent" BorderThickness="0" Name="lb"
                     SelectedIndex="0" ItemsSource="{Binding DeviceVariables}">
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ListBoxItem">
                                    <Border Padding="10,5" Background="Transparent" Name="border"
                                            BorderBrush="Transparent"
                                            BorderThickness="1,0,0,0" TextBlock.Foreground="#fff">
                                        <ContentPresenter />
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#fff" />
                                            <Setter TargetName="border" Property="TextBlock.Foreground"
                                                    Value="#AA409EFE">
                                            </Setter>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ListBox.ItemContainerStyle>
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition />
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Column="0" Grid.Row="0" Text="{Binding VarName}" Margin="0,0,0,5" />
                            <TextBlock Grid.Column="0" Grid.Row="1" Text="{Binding VarAddress}" />
                            <TextBlock Grid.Column="1" Grid.Row="0" Grid.RowSpan="2"
                                       Text="{Binding VarType}"
                                       VerticalAlignment="Center" HorizontalAlignment="Right">
                            </TextBlock>
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </ScrollViewer>
        <!--第二列-->
        <!--右侧背景颜色-->
        <Border Grid.Row="0" Grid.Column="1" Grid.RowSpan="3" Background="#f7f9fa" />
        <!--关闭按钮-->
        <Button WindowChrome.IsHitTestVisibleInChrome="True" Click="ButtonBase_OnClick" Grid.Column="1"
                HorizontalAlignment="Right" FontSize="16" FontFamily="{StaticResource Iconfont}" Content="&#xeca0;"
                VerticalAlignment="Top" Style="{StaticResource WindowControlButtonStyle}">
        </Button>
        <TextBlock Grid.Row="0" Grid.Column="1" Margin="10,0"
                   Text="{Binding Header,StringFormat={}{0}-状态联控条件配置}" Foreground="#666"
                   VerticalAlignment="Center" FontSize="16" FontWeight="Normal" HorizontalAlignment="Left" />
        <Grid Grid.Row="1" Grid.Column="1" TextBlock.FontSize="12">
            <Grid.RowDefinitions>
                <RowDefinition Height="25" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="50" />
                    <ColumnDefinition />
                    <ColumnDefinition />
                    <ColumnDefinition Width="2*" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" VerticalAlignment="Center" HorizontalAlignment="Center" Text="序号" />
                <TextBlock Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center" Text="对比条件" />
                <TextBlock Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Center" Text="对比值" />
                <TextBlock Grid.Column="3" VerticalAlignment="Center" HorizontalAlignment="Center" Text="操作" />
            </Grid>
            <Border Grid.Row="0" BorderThickness="0,0,0,1" BorderBrush="#ccc" VerticalAlignment="Bottom"></Border>
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Hidden">
                <ItemsControl Margin="10,0" ItemsSource="{Binding ElementName=lb,Path=SelectedItem.UnionConditions }">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid ClipToBounds="True">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="30" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="55" />
                                    <ColumnDefinition />
                                    <ColumnDefinition />
                                    <ColumnDefinition Width="2*" />
                                </Grid.ColumnDefinitions>
                                <Border Grid.Row="0" Background="#eee"></Border>
                                <TextBlock Grid.Column="0"
                                           Text="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter}
,Path=(ItemsControl.AlternationIndex),Converter={StaticResource rnc}, StringFormat={}逻辑-{0}}"
                                           HorizontalAlignment="Center" VerticalAlignment="Center" />
                                <ComboBox Grid.Column="1"
                                          SelectedValuePath="Value" DisplayMemberPath="Header"
                                          SelectedValue="{Binding Condition }"
                                          ItemsSource="{Binding Source={StaticResource Locator},Path=AlarmConditionViewModel.Operators}"
                                          Style="{StaticResource PropSelectorStyle}" />
                                <TextBox Grid.Column="2" Margin="5,0" Tag="对比值" Text="{Binding AlarmValue}" />
                                <TextBlock Grid.Column="3" VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <Hyperlink TextDecorations="None" Command="{Binding AddUnionDeviceCommand}">添加联控设备参数</Hyperlink>
                                    <Hyperlink TextDecorations="None"
                                               Command="{Binding ElementName=lb,Path=SelectedItem.DelUnionConditionCommand}"
                                               CommandParameter="{Binding}">
                                        删除
                                    </Hyperlink>
                                </TextBlock>
                                <Canvas Grid.Row="0" Grid.RowSpan="2">
                                    <TextBlock Text="设备" Canvas.Top="35" Canvas.Left="10" Foreground="#888" />
                                </Canvas>
                                <ItemsControl Grid.Row="1" Margin="55,0,0,0" Background="#f7f9fa" Grid.Column="0"
                                              Grid.ColumnSpan="4" ItemsSource="{Binding UnionDevices}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Height="25" Margin="0,1">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition />
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="1*" />
                                                    <ColumnDefinition Width="30" />
                                                </Grid.ColumnDefinitions>
                                                <ComboBox Style="{StaticResource PropSelectorStyle}"
                                                          SelectedValue="{Binding DNum}" SelectedValuePath="DeviceNum"
                                                          DisplayMemberPath="Header"
                                                          ItemsSource="{Binding Source={StaticResource Locator},Path=EditComponentViewModel.DeviceDropList}">
                                                </ComboBox>
                                                <TextBox Grid.Column="1" Tag="变量地址" Text="{Binding Address }" />
                                                <TextBox Grid.Column="2" Tag="控制值" Text="{Binding Value}" />
                                                <ComboBox Grid.Column="3" SelectedValue="{Binding ValueType}"
                                                          Style="{StaticResource PropSelectorStyle}">
                                                    <ComboBox.ItemsSource>
                                                        <x:Array Type="sys:String">
                                                            <sys:String>Boolean</sys:String>
                                                            <sys:String>Byte</sys:String>
                                                            <sys:String>UInt16</sys:String>
                                                            <sys:String>Int16</sys:String>
                                                            <sys:String>UInt32</sys:String>
                                                            <sys:String>Int32</sys:String>
                                                            <sys:String>UInt64</sys:String>
                                                            <sys:String>Int64</sys:String>
                                                            <sys:String>Single</sys:String>
                                                            <sys:String>Double</sys:String>
                                                        </x:Array>
                                                    </ComboBox.ItemsSource>
                                                </ComboBox>
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Grid>
        <Button Grid.Column="1" Margin="0,0,20,0"
                Grid.Row="2"
                Command="{Binding ElementName=lb,Path=SelectedItem.AddUnionConditionCommand}"
                VerticalContentAlignment="Center"
                Style="{StaticResource WarringButton}"
                HorizontalAlignment="Right">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <TextBlock Margin="0,0,3,0" Text="&#xe607;"
                           VerticalAlignment="Center" FontFamily="{StaticResource Iconfont}" />
                <TextBlock VerticalAlignment="Center" Text="添加联控条件" />
            </StackPanel>
        </Button>
    </Grid>
</Window>