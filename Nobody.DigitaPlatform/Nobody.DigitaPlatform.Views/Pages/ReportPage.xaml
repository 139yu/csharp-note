<UserControl x:Class="Nobody.DigitaPlatform.Views.Pages.ReportPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:Nobody.DigitaPlatform.Views.Pages"
             mc:Ignorable="d"
             xmlns:comm="clr-namespace:Nobody.DigitaPlatform.Common;assembly=Nobody.DigitaPlatform.Common"
             DataContext="{Binding Source={StaticResource Locator},Path=ReportViewModel}"
             d:DesignHeight="450" d:DesignWidth="1000">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary
                    Source="pack://application:,,,/Nobody.DigitaPlatform.Assets;component/Styles/ButtonStyle.xaml" />
                <ResourceDictionary
                    Source="pack://application:,,,/Nobody.DigitaPlatform.Assets;component/Styles/ComboxStyle.xaml" />
                <ResourceDictionary
                    Source="pack://application:,,,/Nobody.DigitaPlatform.Assets;component/Styles/DataGridStyle.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <Style TargetType="ToggleButton" x:Key="ChooseColumnStyle">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ToggleButton">
                            <Border BorderThickness="1" Padding="5,5" Name="bd" CornerRadius="2" Background="#eee"
                                    BorderBrush="#ddd">
                                <TextBlock FontSize="12" Foreground="#999" Text="{TemplateBinding Content}"
                                           VerticalAlignment="Center"
                                           HorizontalAlignment="Center" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="bd" Property="Background" Value="#ddd" />
                                </Trigger>
                                <Trigger Property="IsChecked" Value="True">
                                    <Setter TargetName="bd" Property="Background" Value="#ddd" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style TargetType="CheckBox" x:Key="ColumnSelectorStyle">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="CheckBox">
                            <Border Background="#eee" Padding="10,5" Name="bd" BorderThickness="1" BorderBrush="#fff">
                                <TextBlock VerticalAlignment="Center" FontSize="12" Foreground="#999"
                                           Text="{TemplateBinding Content}" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsChecked" Value="True">
                                    <Setter TargetName="bd" Property="BorderBrush" Value="orange" />
                                    <Setter TargetName="bd" Property="Background" Value="#3F90" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="40" />
            <RowDefinition />
        </Grid.RowDefinitions>
        <Border Height="15" Width="3" CornerRadius="2" HorizontalAlignment="Left" Background="Gold" />
        <TextBlock FontWeight="Normal" FontSize="18" VerticalAlignment="Center" HorizontalAlignment="Left"
                   Margin="5,0,0,0"
                   Text="实时报警状态" Foreground="#AA409EFE" />
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
            <ToggleButton Name="showSelectorBtn" Content="选择数据列" Style="{StaticResource ChooseColumnStyle}"
                          Margin="0,0,10,0" />
            <Button Style="{StaticResource InfoButton}" Command="{Binding RefreshCommand}" Content="刷新" Margin="0,0,10,0" />
            <Button Width="150" Style="{StaticResource PrimaryButton}" Margin="0,0,10,0">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock VerticalAlignment="Center" Margin="0,0,5,0" FontFamily="{StaticResource Iconfont}"
                               Text="&#xe60e;" />
                    <TextBlock Text="导出报警列表"></TextBlock>
                </StackPanel>
            </Button>
        </StackPanel>
        <Popup StaysOpen="False" IsOpen="{Binding ElementName=showSelectorBtn,Path=IsChecked}"
               PlacementTarget="{Binding ElementName=showSelectorBtn}" AllowsTransparency="True"
               VerticalOffset="5">
            <Border Background="#efff" Padding="2,5" Width="330" CornerRadius="5" BorderThickness="1"
                    BorderBrush="#fff">
                <Border.Effect>
                    <DropShadowEffect Color="Gray" Opacity="0.2" ShadowDepth="0" BlurRadius="10"></DropShadowEffect>
                </Border.Effect>
                <ItemsControl ItemsSource="{Binding AllColumns}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <CheckBox Margin="5"
                                      Command="{Binding 
                                RelativeSource={RelativeSource AncestorType=ItemsControl},
                                Path=DataContext.CheckColumnCommand}"
                                      CommandParameter="{Binding}" Content="{Binding Header}"
                                      IsChecked="{Binding IsSelected}"
                                      Style="{StaticResource ColumnSelectorStyle}" />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </Border>
        </Popup>
        <DataGrid Grid.Row="1" ItemsSource="{Binding AllDatas}"
                  comm:DataGridHelper.Columns="{Binding Columns}">

        </DataGrid>
    </Grid>
</UserControl>